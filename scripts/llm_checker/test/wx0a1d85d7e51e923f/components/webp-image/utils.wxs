var isString = function (value) {
  return typeof value === "string";
};
var isNumber = function (value) {
  return typeof value === "number";
};
var getFileExt = function (src) {
  var fileUrl = src.split("?")[0];
  var splitUlr = fileUrl.split("/");
  var filepath =
    splitUlr[
      ((nt_1 = splitUlr.length - 1),
      null == nt_1 ? undefined : "number" === typeof nt_1 ? nt_1 : "" + nt_1)
    ];
  return filepath.split(".")[1] || "jpg";
};
function isUrl(url) {
  var urlReg = getRegExp(
    "/[(http(s)?)://(www.)?a-zA-Z0-9@:%._+~#\x3d]{2,256}.[a-z]{2,6}\x5cb([-a-zA-Z0-9@:%_+.~#?\x26//\x3d]*)/",
    "ig"
  );
  return urlReg.test(url);
}
function rpx2px(rpx, screenWidth) {
  var result = (rpx * (screenWidth || 375)) / 750;
  return Math.round(result);
}
function imageMogr(url, options) {
  if (!isString(url) || !url) return "";
  if (
    url.indexOf("qlogo.cn") !== -1 ||
    url.indexOf("wxfile://") === 0 ||
    url.indexOf("http://tmp/wx") === 0 ||
    url.indexOf("imageMogr2") !== -1
  ) {
    return url;
  }
  if (url.indexOf("http://") === 0) {
    url = url.replace("http://", "https://");
  } else if (url.indexOf("//") === 0) {
    url = "https:" + url;
  }
  if (!options) return url;
  var width = Math.ceil(options.width);
  var height = Math.ceil(options.height);
  var format = options.format;
  var _optionsQuality = options.quality;
  var quality = _optionsQuality === undefined ? 70 : _optionsQuality;
  var _optionsStrip = options.strip;
  var strip = _optionsStrip === undefined ? true : _optionsStrip;
  var crop = options.crop;
  var isValidWidth = isNumber(width) && width > 0;
  var isValidHeight = isNumber(height) && height > 0;
  var imageMogrStr = "";
  var size = "";
  if (isValidWidth && isValidHeight) {
    size = "".concat(width, "x").concat(height);
  } else if (isValidWidth) {
    size = "".concat(width, "x");
  } else if (isValidHeight) {
    size = "x".concat(height);
  }
  if (size) {
    imageMogrStr += "/".concat(crop ? "crop" : "thumbnail", "/").concat(size);
    if (crop) {
      imageMogrStr += "/gravity/center";
    }
  }
  if (isNumber(quality)) {
    imageMogrStr += "/quality/".concat(quality);
  }
  if (strip) {
    imageMogrStr += "/strip";
  }
  var ext = getFileExt(url);
  if (ext === "gif") {
    imageMogrStr += "/cgif/1";
  } else if (format) {
    imageMogrStr += "/format/".concat(format);
  }
  if (format === "jpg" || (!format && (ext === "jpg" || ext === "jpeg"))) {
    imageMogrStr += "/interlace/1";
  }
  if (!imageMogrStr) return url;
  return ""
    .concat(url)
    .concat(url.indexOf("?") !== -1 ? "\x26" : "?", "imageMogr2")
    .concat(imageMogrStr);
}
function getSrc(options) {
  if (!options.src) return "";
  if (options.thumbWidth || options.thumbHeight) {
    return imageMogr(options.src, {
      width:
        options.mode !== "heightFix"
          ? rpx2px(options.thumbWidth, options.systemInfo.screenWidth) *
            options.systemInfo.pixelRatio
          : null,
      height:
        options.mode !== "widthFix"
          ? rpx2px(options.thumbHeight, options.systemInfo.screenWidth) *
            options.systemInfo.pixelRatio
          : null,
      format: options.webp ? "webp" : null,
    });
  }
  return "";
}
module.exports = { imageMogr: imageMogr, getSrc: getSrc };
